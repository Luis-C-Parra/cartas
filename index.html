<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TELEFUNKEN FAMILIAR</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    /* Reset y base */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      color: #2c3e50;
      min-height: 100vh;
      padding: 20px;
    }

    /* Splash Screen */
    #splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #C0D9D9;
      color: #1a1a1a;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      text-align: center;
      animation: fadeIn 0.8s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    #splash h1 {
      font-size: 5rem;
      margin: 0;
      color: #2196F3;
      font-weight: 700;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.1);
    }

    #splash h2 {
      font-size: 2.5rem;
      margin: 10px 0 0;
      color: #333;
    }

    #splash p {
      font-size: 1.2rem;
      margin-top: 15px;
      color: #444;
    }

    /* Main Content */
    #mainContent {
      display: none;
      opacity: 0;
      animation: slideIn 0.6s ease-out forwards;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      font-size: 3.5rem;
      color: #1565C0;
      text-align: center;
      margin: 20px 0 30px;
      font-weight: 700;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }

    /* Inputs */
    .controls {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    label {
      font-size: 1.1rem;
      color: #333;
      margin-right: 10px;
    }

    select, input[type="text"] {
      font-size: 1.1rem;
      padding: 8px 12px;
      border: 2px solid #64b5f6;
      border-radius: 8px;
      outline: none;
      width: 180px;
      transition: border-color 0.3s;
    }

    select:focus, input[type="text"]:focus {
      border-color: #1976D2;
    }

    button {
      font-size: 1rem;
      background-color: #2196F3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px 5px;
      transition: background-color 0.3s, transform 0.2s;
      font-weight: 600;
    }

    button:hover {
      background-color: #1976D2;
      transform: scale(1.05);
    }

    button:active {
      transform: scale(0.98);
    }

    /* Inputs Jugadores */
    #inputJugadores {
      margin: 20px auto;
      max-width: 600px;
    }

    #inputJugadores div {
      margin: 10px 0;
    }

    input[type="text"] {
      width: 250px;
      text-align: center;
    }

    input[type="text"]:not(:placeholder-shown) {
      background-color: #e8f5e9;
      border-color: #4caf50;
    }

    /* Grid de Jugadores */
    .jugadores-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
    }

    .jugador {
      background: #ffffff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      flex: 1 1 300px;
      max-width: 350px;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .jugador:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }

    .jugador h3 {
      font-size: 1.6rem;
      color: #1565C0;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 1rem;
    }

    th {
      background-color: #2196F3;
      color: white;
      padding: 10px;
      font-weight: 600;
    }

    td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }

    tr:nth-child(even) {
      background-color: #f5f9ff;
    }

    .monedas {
      background-color: #ffe0b2;
      font-weight: bold;
      color: #d84315;
    }

    .total {
      font-weight: bold;
      background-color: #2196F3;
      color: white;
    }

    input[type="number"] {
      width: 60px;
      padding: 6px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    input[type="number"]:focus {
      border-color: #2196F3;
      outline: none;
    }

    /* Campo con valor (relleno) */
    input[type="number"].filled {
      background-color: #c8e6c9 !important;
      color: #1b5e20;
      font-weight: bold;
    }

    /* Ranking */
    #ranking {
      max-width: 800px;
      margin: 30px auto;
      padding: 15px;
      background: #e3f2fd;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      font-size: 1.3rem;
      color: #1565C0;
      text-align: center;
      font-weight: 600;
    }

    #ranking p {
      margin: 8px 0;
    }

    /* Footer */
    footer {
      margin-top: 50px;
      text-align: center;
      font-size: 0.95rem;
      color: #555;
      font-style: italic;
      padding: 20px;
      border-top: 1px solid #ddd;
      background: #ffffff;
      border-radius: 10px;
      max-width: 800px;
      margin: 50px auto 20px;
    }

    /* Botón de reinicio */
    #btnReiniciar {
      background-color: #d32f2f;
      margin-top: 15px;
      font-weight: 600;
    }

    #btnReiniciar:hover {
      background-color: #b71c1c;
    }

    /* Responsive */
    @media (max-width: 768px) {
      h1 {
        font-size: 2.5rem;
      }
      #splash h1 {
        font-size: 3rem;
      }
      #splash h2 {
        font-size: 1.8rem;
      }
      .jugador {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>

  <!-- Splash Screen -->
  <div id="splash">
    <h1>TELEFUNKEN</h1>
    <h2>FAMILIAR</h2>
    <p>Programado por Luis C. Parra</p>
  </div>

  <!-- Contenido Principal -->
  <div id="mainContent">
    <h1>TELEFUNKEN FAMILIAR</h1>

    <div class="controls">
      <label for="numJugadores">Cantidad de jugadores:</label>
      <select id="numJugadores" onchange="crearInputsJugadores()">
        <option value="">Seleccionar</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
      </select>
    </div>

    <div id="inputJugadores"></div>

    <div style="text-align:center; margin: 20px 0;">
      <button onclick="crearTablasJugadores()">Iniciar Juego</button>
    </div>

    <div id="jugadores" class="jugadores-grid"></div>

    <div id="ranking"></div>

    <div style="text-align:center; margin: 20px 0;">
      <button id="btnReiniciar" onclick="reiniciarJuego()">Comenzar de Nuevo</button>
    </div>

    <footer>
      Programado por Luis C. Parra &nbsp; | &nbsp; © 2025 &nbsp; | &nbsp; Contacto: luiscocabia@hotmail.com
    </footer>
  </div>

  <script>
    // === PERSISTENCIA CON localStorage ===
    const KEY_STATE = "telefunkenGameState";

    function getState() {
      const data = localStorage.getItem(KEY_STATE);
      return data ? JSON.parse(data) : null;
    }

    function guardarEstado() {
      const num = parseInt(document.getElementById('numJugadores').value);
      const jugadores = [];

      for (let i = 0; i < num; i++) {
        const valores = [];
        for (let j = 0; j < 7; j++) {
          const input = document.getElementById(`input${i}_${j}`);
          valores.push(input ? input.value : '');
        }
        jugadores.push({
          nombre: (document.getElementById(`jugador${i}`)?.value || "").toUpperCase(),
          monedas: parseInt(document.getElementById(`monedas${i}`)?.innerText) || 7,
          valores,
          total: parseInt(document.getElementById(`total${i}`)?.innerText) || 0
        });
      }

      const estado = {
        numJugadores: num,
        jugadores,
        iniciado: true
      };

      localStorage.setItem(KEY_STATE, JSON.stringify(estado));
    }

    function cargarEstado() {
      const state = getState();
      if (!state) return;

      const select = document.getElementById('numJugadores');
      select.value = state.numJugadores;

      // Crear inputs de nombres
      crearInputsJugadores();

      // Si ya se inició, crear tablas y cargar datos
      if (state.iniciado) {
        setTimeout(() => {
          crearTablasJugadoresConDatos(state.jugadores);
        }, 100);
      }
    }

    function crearInputsJugadores() {
      const num = parseInt(document.getElementById('numJugadores').value) || 0;
      const contenedor = document.getElementById('inputJugadores');
      contenedor.innerHTML = '';

      const state = getState();
      const savedNames = state?.jugadores || [];

      for (let i = 0; i < num; i++) {
        const savedName = savedNames[i]?.nombre || '';
        contenedor.innerHTML += `
          <div>
            <label>Jugador ${i + 1}: </label>
            <input type="text" id="jugador${i}" placeholder="Nombre" value="${savedName}"
                   oninput="this.value = this.value.toUpperCase(); guardarEstadoTemporal()" />
          </div>
        `;
      }
    }

    function crearTablasJugadores() {
      const num = parseInt(document.getElementById('numJugadores').value);
      const jugadoresDiv = document.getElementById('jugadores');
      jugadoresDiv.innerHTML = '';

      for (let i = 0; i < num; i++) {
        const nombre = (document.getElementById(`jugador${i}`).value || `JUGADOR ${i + 1}`).toUpperCase();
        jugadoresDiv.innerHTML += generarTablaJugador(nombre, i);
      }

      // Guardar estado inicial (sin datos de juego)
      const tempState = {
        numJugadores: num,
        jugadores: [],
        iniciado: true
      };
      localStorage.setItem(KEY_STATE, JSON.stringify(tempState));

      // Actualizar ranking
      setTimeout(actualizarRanking, 100);
    }

    // === Nueva función: crear tablas Y cargar datos ===
    function crearTablasJugadoresConDatos(jugadoresData) {
      const num = jugadoresData.length;
      const jugadoresDiv = document.getElementById('jugadores');
      jugadoresDiv.innerHTML = '';

      for (let i = 0; i < num; i++) {
        const nombre = jugadoresData[i]?.nombre || `JUGADOR ${i + 1}`;
        jugadoresDiv.innerHTML += generarTablaJugador(nombre, i);
      }

      // Ahora que los elementos existen, cargar los valores
      setTimeout(() => {
        jugadoresData.forEach((j, i) => {
          if (document.getElementById(`monedas${i}`)) {
            document.getElementById(`monedas${i}`).innerText = j.monedas;
          }
          for (let k = 0; k < 7; k++) {
            const input = document.getElementById(`input${i}_${k}`);
            if (input && j.valores[k] !== undefined) {
              input.value = j.valores[k];
              if (j.valores[k] !== '') input.classList.add('filled');
            }
          }
          if (document.getElementById(`total${i}`)) {
            document.getElementById(`total${i}`).innerText = j.total;
          }
        });
        actualizarRanking();
      }, 100);
    }

    function generarTablaJugador(nombre, index) {
      const items = ["TRICA", "DOS TRICAS", "TRES TRICAS", "CUARTO", "2 CUARTOS", "QUINA", "ESCALERA"];
      let tabla = `
        <div class="jugador" id="jugadorDiv${index}">
          <h3>${nombre}</h3>
          <table>
            <tr><th>Nombres</th><th>monedas</th></tr>
            <tr>
              <td class="monedas">monedas</td>
              <td id="monedas${index}">7</td>
            </tr>
            <tr>
              <td>Acciones</td>
              <td>
                <button onclick="comprar(${index})">Comprar</button>
                <button onclick="devolver(${index})">Devolver</button>
              </td>
            </tr>
      `;
      items.forEach((item, i) => {
        tabla += `
          <tr>
            <td>${item}</td>
            <td>
              <input type="number" min="0" id="input${index}_${i}" placeholder=" " 
                     oninput="actualizarEstadoCampo(this); calcularTotal(${index})">
            </td>
          </tr>`;
      });
      tabla += `<tr><td class="total">total</td><td id="total${index}" class="total">0</td></tr>`;
      tabla += `</table></div>`;
      return tabla;
    }

    function actualizarEstadoCampo(input) {
      if (input.value.trim() !== '') {
        input.classList.add('filled');
      } else {
        input.classList.remove('filled');
      }
      guardarEstado();
    }

    function comprar(index) {
      let monedas = parseInt(document.getElementById(`monedas${index}`).innerText);
      if (monedas > 0) {
        monedas--;
        document.getElementById(`monedas${index}`).innerText = monedas;
        guardarEstado();
        actualizarRanking();
      }
    }

    function devolver(index) {
      let monedas = parseInt(document.getElementById(`monedas${index}`).innerText);
      monedas++;
      document.getElementById(`monedas${index}`).innerText = monedas;
      guardarEstado();
      actualizarRanking();
    }

    function calcularTotal(index) {
      let total = 0;
      for (let i = 0; i < 7; i++) {
        const input = document.getElementById(`input${index}_${i}`);
        total += parseInt(input.value || 0);
        actualizarEstadoCampo(input);
      }
      document.getElementById(`total${index}`).innerText = total;
      guardarEstado();
      actualizarRanking();
    }

    function actualizarRanking() {
      const numSelect = document.getElementById('numJugadores').value;
      const num = numSelect ? parseInt(numSelect) : 0;
      let puntajes = [];

      for (let i = 0; i < num; i++) {
        const nombre = (document.getElementById(`jugador${i}`)?.value || `JUGADOR ${i + 1}`).toUpperCase();
        const total = parseInt(document.getElementById(`total${i}`)?.innerText) || 0;
        puntajes.push({ nombre, total });
      }

      puntajes.sort((a, b) => a.total - b.total);
      let rankingHTML = `<p>🏅 1º lugar: ${puntajes[0]?.nombre} (${puntajes[0]?.total})</p>`;
      if (puntajes[1]) rankingHTML += `<p>🥈 2º lugar: ${puntajes[1].nombre} (${puntajes[1].total})</p>`;
      if (puntajes[2]) rankingHTML += `<p>🥉 3º lugar: ${puntajes[2].nombre} (${puntajes[2].total})</p>`;
      document.getElementById('ranking').innerHTML = rankingHTML;
    }

    function reiniciarJuego() {
      if (confirm("¿Estás seguro de que deseas comenzar de nuevo? Todos los datos se perderán.")) {
        localStorage.removeItem(KEY_STATE);
        location.reload();
      }
    }

    function guardarEstadoTemporal() {
      const num = document.getElementById('numJugadores').value;
      if (num) {
        const jugadores = [];
        for (let i = 0; i < num; i++) {
          const input = document.getElementById(`jugador${i}`);
          jugadores.push({ nombre: input ? input.value : '' });
        }
        const tempState = { numJugadores: num, jugadores, iniciado: false };
        localStorage.setItem(KEY_STATE, JSON.stringify(tempState));
      }
    }

    // === Cargar todo al inicio ===
    window.onload = function() {
      cargarEstado(); // Intentar cargar estado guardado

      setTimeout(() => {
        const splash = document.getElementById("splash");
        splash.style.animation = "fadeOut 0.8s forwards";
        setTimeout(() => {
          splash.style.display = "none";
          document.getElementById("mainContent").style.display = "block";
        }, 800);
      }, 2000);
    };
  </script>

</body>
</html>